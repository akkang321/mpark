<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zenith.user.mypage.dao.UserCouponDao">


	<select id="userCouponList" parameterType="hashmap" resultType="hashmap">
		SELECT 		UC.USER_ID		,UC.CR_ID		,UC.COUPON_ID		,CI.COUPON_NAME		,DATE_FORMAT(CI.EXPIRY_DATE, '%Y-%m-%d') AS EXPIRY_DATE
					,CI.COUPON_TYPE	,CI.COUPON_DISCOUNT
		FROM 		USER_COUPON UC
			LEFT 	JOIN 	COUPON_INFO CI 
				ON 	CI.COUPON_ID=UC.COUPON_ID
    	WHERE 	UC.USER_ID=#{ uId }
    	AND 	UC.USE_YN='C150100' 
    	AND		DATE_FORMAT(CI.EXPIRY_DATE, '%Y%m%d') >= DATE_FORMAT(NOW(), '%Y%m%d') 
	</select>


	<insert id="userCouponInsert" parameterType="hashmap">
		INSERT INTO USER_COUPON(COUPON_ID, USER_ID, USE_YN, CREATE_DATE, USE_DATE) 
		VALUES(#{couponId}, #{uId}, "C150100", NOW(), NOW()) 
	</insert>
	
	
	<select id="couponIdCheck" parameterType="String" resultType="int">
		SELECT 	COUNT(1) FROM COUPON_INFO
		WHERE 	COUPON_ID=#{couponId}
	</select>


	<select id="couponUseCheck" parameterType="hashmap" resultType="int"> 
		SELECT 	COUNT(1) FROM USER_COUPON
		WHERE 	COUPON_ID=#{couponId}
		AND		USER_ID=#{uId}
	</select>


</mapper>


