<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.zenith.common.dao.FileDao">
	<select id="fileSelect" parameterType="String" resultType="hashmap">
            SELECT 	FILE_ID				,FILE_NAME		,FILE_ORG_NAME	,FILE_SIZE
            		,FILE_PATH		,FILE_TYPE		,FILE_IMAGE		,FILE_DOWNLOAD
            		,FILE_USE_TABLE		,FILE_USE_ID	,CREATE_ID		,CREATE_DATE
            		,UPDATE_ID			,UPDATE_DATE 
            FROM 	FILE_INFO
            WHERE	FILE_ID = #{fileId}
    </select>

    <insert id="fileInsert" parameterType="hashmap" useGeneratedKeys="true" keyProperty="fileId">
		INSERT INTO FILE_INFO
				(
					FILE_NAME			,FILE_ORG_NAME	,FILE_SIZE
					,FILE_PATH			,FILE_TYPE		,FILE_IMAGE		
					,FILE_USE_TABLE		,FILE_USE_ID	,CREATE_ID		,CREATE_DATE
				)
		VALUES
				(
					#{fileName}			,#{fileOrgName}	,#{fileSize}	
					,#{filePath}		,#{fileType}	,#{fileImage}	
					,#{fileUseTable}	,#{fileUseId}	,#{uId}		,NOW()
				)
	</insert>
   
	<update id="fileUpdate" parameterType="hashmap">
		<![CDATA[
			UPDATE	FILE_INFO 
			SET		FILE_NAME = #{fileName}		,FILE_ORG_NAME = #{fileOrgName}		,FILE_SIZE = #{fileSize}
					,FILE_PATH = #{filePath}	,FILE_TYPE = #{fileType}			,FILE_IMAGE = #{fileImage}	
					,UPDATE_ID = #{uId}
					,UPDATE_DATE = NOW()
			WHERE	FILE_ID = #{fileId}	
		]]>
	</update>
     
	<delete id="fileDelete" parameterType="String">
			DELETE	FROM FILE_INFO 
			WHERE	FILE_ID = #{fileId}
	</delete>
	
	<select id="fileIds" parameterType="String" resultType="String">
            SELECT 	FILE_ID	
            FROM 	FILE_INFO
            WHERE	FILE_USE_ID = #{useId}
    </select>
    
	<delete id="fileDeleteByUseId" parameterType="String">
			DELETE	FROM FILE_INFO 
			WHERE	FILE_USE_ID = #{useId}
	</delete>
	
	<select id="filePaths" parameterType="hashmap" resultType="hashmap">
            SELECT 	FILE_ID	,FILEPATH(FILE_ID) AS FILE_PATH	
            FROM 	FILE_INFO
            WHERE	FILE_USE_ID = #{useId}
            AND		FILE_USE_TABLE = #{fileUseTable}
            AND		FILE_ID NOT IN(
									SELECT 		PHOTO_ID 
									FROM 		TEACHER_INFO 
									WHERE 		T_ID=#{tId}
									);
    </select>
	
    
</mapper>